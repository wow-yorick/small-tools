var editorSettings={type:0,getURL:function(){if(this.settingsID&&this.type==2){return this.url+"&settingsID="+encodeURI(editorSettings.settingsID+".tmp")}else{return this.url}},willLoad:function(){return(editorSettings.type==1||(editorSettings.type==2&&editorSettings.settingsID))}};$.editorTypes={"user.design":2,"user.position":1};if(window.dialogArguments){$.extend(editorSettings,window.dialogArguments)}if($.editorTypes[editorSettings.type]){editorSettings.type=$.editorTypes[editorSettings.type]}$(function(){var a="12";function L(aH){var j=P().getLastSettings(aH);return j}var ai=0;var aB=100;var al="images/blank.png";String.prototype.format=String.prototype.f=function(){var aH=this,j=arguments;var aI=/\{([0-9]+)\}/g;return aH.replace(aI,function(aK,aJ){return j[parseInt(aJ)]})};function Y(j,aH){j=j.replace(/\n\s*\n/g,"\n");j=j.replace(/^[\s\n]*/,"");j=j.replace(/[\s\n]*$/,"");ai=0;aH(j)}function X(aH,aN){var aK=0;function aL(){var aQ=aK;for(;aK<aH.length&&aK<aQ+aB;aK++){aM=aK;if(-1==aH.substr(aK).indexOf("<")){aJ+=aH.substr(aK);Y(aJ,aN);return}while(aM<aH.length&&"<"!=aH.charAt(aM)){aM++}if(aK!=aM){aO=aH.substr(aK,aM-aK);if(!aO.match(/^\s+$/)){if("\n"==aJ.charAt(aJ.length-1)){aJ+=S()}else{if("\n"==aO.charAt(0)){aJ+="\n"+S();aO=aO.replace(/^\s+/,"")}}aO=aO.replace(/\s+/g," ");aJ+=aO}if(aO.match(/\n/)){aJ+="\n"+S()}}j=aM;while(aM<aH.length&&">"!=aH.charAt(aM)){aM++}aP=aH.substr(j,aM-j);aK=aM;if("!--"==aP.substr(1,3)){if(!aP.match(/--$/)){while("-->"!=aH.substr(aM,3)){aM++}aM+=2;aP=aH.substr(j,aM-j);aK=aM}if("\n"!=aJ.charAt(aJ.length-1)){aJ+="\n"}aJ+=S();aJ+=aP+">\n"}else{if("!"==aP[1]){aJ=w(aP+">",aJ)}else{if("?"==aP[1]){aJ+=aP+">\n"}else{if(t=aP.match(/^<(script|style)/i)){t[1]=t[1].toLowerCase();aP=I(aP);aJ=w(aP,aJ);var aR=aP.match(/^<style/i);aI=String(aH.substr(aK+1)).toLowerCase().indexOf("</"+t[1]);if(aI){aO=aH.substr(aK+1,aI);if(aR){aO=aO.replace(/^([\s]*)(.*)$/gm,function(aS,aU,aT){return("\t"+(aT||""))})}aK+=aI;aJ+=aO}}else{aP=I(aP);aJ=w(aP,aJ)}}}}}if(aK<aH.length){setTimeout(aL,0)}else{Y(aJ,aN)}}var aM=0,j=null,aI=null,aP="",aJ="",aO="";aL()}function S(){var aI="";for(var aH=0;aH<ai;aH++){aI+="\t"}return aI}function I(aH){var aK="";aH=aH.replace(/\n/g," ");aH=aH.replace(/[\s]{2,}/g," ");aH=aH.replace(/^\s+|\s+$/g," ");var aJ="";if(aH.match(/\/$/)){aJ="/";aH=aH.replace(/\/+$/,"")}var j,aI=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/;while(j=aI.exec(aH)){if(j[2]){aK+=j[1].toLowerCase()+"="+j[2]}else{if(j[1]){aK+=j[1].toLowerCase()}}aK+=" ";aH=aH.substr(j[0].length)}return aK.replace(/\s*$/,"")+aJ+">"}var E=["area","body","head","hr","i?frame","link","meta","noscript","style","table","tbody","thead","tfoot"];var ac=["li","dt","dt","h[1-6]","option","script"];var i=new RegExp("^<(/?"+E.join("|/?")+"|"+ac.join("|")+")[ >]");lineAfter=new RegExp("^<(br|/?"+E.join("|/?")+"|/"+ac.join("|/")+")[ >]");var aa=["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul","object"];aa=new RegExp("^</?("+aa.join("|")+")[ >]");function w(j,aI){var aH=j.match(aa);if(j.match(i)||aH){aI=aI.replace(/\s*$/,"");aI+="\n"}if(aH&&"/"==j.charAt(1)){ai--}if("\n"==aI.charAt(aI.length-1)){aI+=S()}if(aH&&"/"!=j.charAt(1)){ai++}aI+=j;if(j.match(lineAfter)||j.match(aa)){aI=aI.replace(/ *$/,"");aI+="\n"}return aI}var z="html 文件 (*.htm;*.html)|*.htm;*.html|所有文件 (*.*)|*.*";function P(){if(!$.jp){var j=$("#jp-ax");var aH=j.contents()[0];$.jp=navigator.userAgent.indexOf("MSIE")>-1?aH.getElementById("ojatoolsPrinter"):aH.getElementById("ejatoolsPrinter")}return $.jp}function D(j){P().copy(j)}function u(){return P().copied()}function aD(aI){var aH=P();var j=aH.chooseFile(z,"htm",true);if(j){aH.writeHTML(j,aI)}}function aq(aH){var j=$("#jp-error-dialog").dialog({dialogClass:"jp-error-dialog",width2:200,buttons:{"知道了":function(){$(this).dialog("close")}}}).find(".jp-error-text").html(aH)}function r(){var aK=P();var aJ=aK.chooseFile(z,"htm",false);if(aJ){var aI=aK.readHTML(aJ);var aH=$('<iframe class="jp-html-loader"><iframe>');$(document.body).append(aH);var aL=aH.contents()[0];aL.open();aL.writeln(aI);aL.close();var j=$(".jp-page",aL);if(!j.length){aq("你的文档有问题啊,没找到 <strong>id</strong> 为 <strong>page1</strong> 对象啊!")}else{b.sourceCodeViewer.util.decode(j)}aH.remove()}}function ag(j,aI){var aH=$('<style type="text/css"></style>').appendTo($("head",aI)).attr({type:"text/css"})[0];if(aH.styleSheet!==undefined&&aH.styleSheet.cssText!==undefined){aH.styleSheet.cssText=j}else{aH.appendChild(document.createTextNode(j))}return aH}function H(aI,aH){var aK=aI.contents()[0];var j=$("#page1",aK);if(!j.length){aq("你的文档有问题啊,没找到 <strong>id</strong> 为 <strong>page1</strong> 对象啊!")}else{var aJ=L(editorSettings.settingsID);an.applySettings(aJ);ag(an.styles,aK);b.sourceCodeViewer.util.decode(j,aH)}aI.remove()}function C(aH){var j=$('<iframe class="jp-html-loader" style="position:absolute;top:0px;left:0;width:0;height:0"><iframe>')[0];if($.browser.msie){j.onreadystatechange=function(){if(j.readyState=="complete"){H($(j),aH)}}}else{j.onload=function(){H($(j),aH)}}$(document.body).append($(j));j.src=aH}var N=null;function f(){N&&N.data("dropdown-trigger").dropdown("hide");aj&&$(aj).spectrum("hide")}function ar(aJ){aJ.extend(aJ.fn,{dropdown:function(aL,aK){switch(aL){case"hide":aI();return aJ(this);case"attach":return aJ(this).attr("data-dropdown",aK);case"detach":aI();return aJ(this).removeAttr("data-dropdown");case"disable":return aJ(this).addClass("dropdown-disabled");case"enable":aI();return aJ(this).removeClass("dropdown-disabled")}}});function aH(aM){var aK=aJ(this),aN=aJ(aK.attr("data-dropdown")),aL=aK.hasClass("dropdown-open");if(aK!==aM.target&&aJ(aM.target).hasClass("dropdown-ignore")){return}aM.preventDefault();aM.stopPropagation();aI();if(aL||aK.hasClass("dropdown-disabled")){return}aK.addClass("dropdown-open");aN.data("dropdown-trigger",aK).show();j();aN.trigger("show",{dropdown:aN,trigger:aK});N=aN}function aI(aK){var aL=aK?aJ(aK.target).parents().addBack():null;if(aL&&aL.is(".dropdown")){if(aL.is(".dropdown-menu")){if(!aL.is("A")){return}}else{return}}aJ(document).find(".dropdown:visible").each(function(){var aM=aJ(this);aM.hide().removeData("dropdown-trigger").trigger("hide",{dropdown:aM})});aJ(document).find(".dropdown-open").removeClass("dropdown-open");N=null}function j(){var aN=aJ(".dropdown:visible").eq(0),aK=aN.data("dropdown-trigger"),aL=aK?parseInt(aK.attr("data-horizontal-offset")||0,10):null,aM=aK?parseInt(aK.attr("data-vertical-offset")||0,10):null;if(aN.length===0||!aK){return}aN.css({left:aN.hasClass("dropdown-anchor-right")?aK.offset().left-(aN.outerWidth()-aK.outerWidth())+aL:aK.offset().left+aL,top:aK.offset().top+aK.outerHeight()+aM})}aJ(document).on("click.dropdown","[data-dropdown]",aH);aJ(document).on("click.dropdown",aI);aJ(window).on("resize",j)}ar(jQuery);function v(aJ,j,aH,aI,aK){this.target=aJ;if($.isFunction(j[0])){this.$unfn=j[0];this.$refn=j[1];this.arg=j[2]||null}else{this.$fn=$.fn[j[0]];this.arg=j.slice(1);this.arg.push(null);this.oldval=$.isArray(aH)?aH:[aH];this.newval=aI}this.callback=aK}v.prototype.undo=function(){var j=this;this.target.each(function(aH){if(j.$unfn){j.$unfn.call(j)}else{j.$fn.apply($(this),j.arg._last(j.oldval[aH]||""))}});this.callback&&this.callback(this);return this};v.prototype.redo=function(){var aH=this,j=$.isArray(this.newval);this.target.each(function(aI){if(aH.$refn){aH.$refn.call(aH)}else{aH.$fn.apply($(this),aH.arg._last((j?aH.newval[aI]:aH.newval)))}});this.callback&&this.callback(this);return this};function az(j){this.callback=j;this.edits=[]}az.prototype.undo=function(){for(var j=this.edits.length-1;j>=0;j--){this.edits[j].undo()}return this};az.prototype.redo=function(){for(var j=0;j<this.edits.length;j++){this.edits[j].redo()}return this};function aC(j,aH){this.listener=aH;this.undos=[];this.redos=[]}aC.prototype.clear=function(){this.undos=[];this.redos=[]};aC.prototype.fire=function(j){j&&j.callback&&j.callback.call(j,j.target)};aC.prototype.undo=function(){var j=null;this.undos.length&&this.redos.push(j=this.undos.pop().undo())&&this.fire(j)};aC.prototype.redo=function(){var j=null;this.redos.length&&this.undos.push(j=this.redos.pop().redo())&&this.fire(j)};aC.prototype.add=function(j){if(this.group){this.group.edits.push(j)}else{this.undos.push(j);this.redos=[];this.fire()}};aC.prototype.open=function(){this.group=new az()};aC.prototype.close=function(){var j=this.group;this.group=null;this.add(j)};var ao=new aC();$s=function(){return $(".ui-selected")};var T=$.fn.attr;$.fn.extend({select:function(){return $(this).addClass("ui-selected")},unselect:function(){return $(this).removeClass("ui-selected")},selected:function(){return $(this[0]).hasClass("ui-selected")},vals:function(aJ,aH){var aI=$.fn[aJ[0]],j=aJ.slice(1);return this.each(function(){aH.push(aI.apply($(this),j))})},attr2:function(aJ,aI){var aH=T.apply(this,arguments);if(aI!=undefined||aJ!="_codestyle"||aH){return aH}else{var j=this.parent().html().match(/\b_codestyle\s*=\s*(['"])(.*?)\1/);return j?j[2]:""}},cssFrom:function(aI,aH){var j=this;$.each(aH,function(){j.css(this,$(aI).css(this))});return this},_css:function(aH,aJ){var aI=[],j=["css",aH];this.vals(j,aI).css(aH,aJ);ao.add(new v(this,j,aI,aJ));return this},_object:function(){return this.find("object,embed").first()},borderStyle:function(aJ){var j={},aI=this,aH=($(this).attr("style")||"").split(";");if(typeof(aJ)=="undefined"){$.each(aH,function(){var aK=this.split(":");if(aK.length==2&&$.trim(aK[0]).match(/^border.*$/)){j[$.trim(aK[0])]=$.trim(aK[1])}});return j}else{$.each(aH,function(){var aK=this.split(":");if(aK.length==2&&$.trim(aK[0]).match(/^border.*$/)){$(aI).css($.trim(aK[0]),"")}});return this.css(aJ)}},_outerHTML:function(){return jQuery("<p>").append(this.eq(0).clone()).html()},_border:function(){var aH={},aI="",j=true,aJ=this[0];$.each(["Top","Right","Bottom","Left"],function(aK,aM){var aL=$.css(aJ,"border"+aM+"Style")+" "+$.css(aJ,"border"+aM+"Color")+" "+$.css(aJ,"border"+aM+"Width");aH["border-"+aM.toLowerCase()]=aL.match(/^none.*/)?"":aL;if(aK){if(aI!=aL){j=false}}aI=aL});return j?{border:aH["border-top"]}:aH},_codeData:function(aH){var aI=this.is("object");if(aH==undefined){var j={};if(aI){this.find("param").each(function(){j[$(this).attr("name")]=$(this).attr("value")})}else{j._codestyle=this.attr("_codestyle");j._code=this.attr("_code")}return j}else{if(aI){this.find("param").each(function(){$(this).attr("value",aH[$(this).attr("name")])})}else{this.attr(aH)}try{this[0].setData(aH._code,aH._codestyle)}catch(aJ){}return this}},_style:function(j){return $.style(this[0],j)},_copyClass:function(aH,j){if($(aH).is("."+j)){this.addClass(j)}else{this.removeClass(j)}return this},_copyCss:function(aI,aH){if(!$.isArray(aH)){aH=[aH]}var j=this;$.each(aH,function(aJ,aK){j.css(aK,$(aI).css(aK))});return this},_copyAttr:function(aJ,aI,aH){if(!$.isArray(aI)){aI=[aI]}var j=this;$.each(aI,function(aK,aL){if(aH){j.attr(aL,$(aJ).attr(aL)||aH)}else{j.attr(aL,$(aJ).attr(aL))}});return this},_appendTo:function(j){if(!j){this.remove()}else{c($(this).appendTo(at).select())}return this},_removeFrom:function(j){if(!j){c($(this).appendTo(at).select())}else{this.remove()}return this},_uClass:function(aJ){if(typeof(aJ)=="undefined"){var aH=/\bjp\-comp\-[0-9]+/;var aI=$(this).attr("class");var j=aI.match(aH);return j?j[0]:""}else{this.addClass(aJ);return this}}});Array.prototype._last=function(j){this[this.length-1]=j;return this};function W(j,aH,aI,aJ){$(j).keydown(function(aK){if(aK.keyCode==13){aK.preventDefault();aJ($(j).val())}}).blur(function(){aJ($(j).val())});$(aH).click(function(){var aK=P().chooseFile(aI,"",false);if(aK){$(j).val("file:///"+aK.replace(/(\\)/g,"/"));aJ($(j).val())}})}function h(j,aI,aJ,aH,aK){$(j).keydown(function(aL){if(aL.keyCode==13){aL.preventDefault();aK($(j).val())}}).blur(function(){aK($(j).val())});$(aI).click(function(){var aL=P().chooseFile(aJ,"",false);if(aL){var aM=P().getFileBase64(aL);$.post(aH,{name:aL,data:aM},function(aN){$(j).val(aN.replace(/\n/g,""));aK($(j).val())})}})}function ak(){var j=this;this.setPaper=function(){if(j.$paperWidth.val()&&j.$paperHeight.val()){var aJ=!this.$orientation.is(".jp-landscape-icon"),aH=this.$paperWidth.val()+"mm",aI=this.$paperHeight.val()+"mm";if(aJ){at.css({width:aH,height:aI}).removeClass("jp-landscape")}else{at.addClass("jp-landscape").css({width:aI,height:aH})}}K&&K.reposition()};this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-new-dialog");if(editorSettings.type==2){this.$dialog.addClass("jp-with-remote")}this.$dialog.dialog({autoOpen:false,width:510,buttons:{"确定":function(){var aN=j.oldData;ao.open();var aL=aN.src,aM=j.$background.attr("src"),aK=["attr","src"];ao.add(new v(j.$background,aK,aL,aM));aK=["css"];ao.add(new v(j.$background,aK,{filter:aN.filter,opacity:aN.opacity},{filter:j.$background.css("filter"),opacity:j.$background.css("opacity")}));ao.add(new v(at,aK,{width:aN.portrait?aN.width:aN.height,height:aN.portrait?aN.height:aN.width},{width:at._style("width"),height:at._style("height")}));if(aN.portrait&&at.is(".jp-landscape")){ao.add(new v(at,[function(){at.removeClass("jp-landscape")},function(){at.addClass("jp-landscape")}]))}else{if(!aN.portrait&&!at.is(".jp-landscape")){ao.add(new v(at,[function(){at.addClass("jp-landscape")},function(){at.removeClass("jp-landscape")}]))}}ao.add(new v(at,aK,{width:aN.width,height:aN.height},{width:at._style("width"),height:at._style("height")}));ao.close();$(this).dialog("close")},"取消":function(){var aK=j.oldData;j.$background.attr("src",aK.src).css({filter:aK.filter,opacity:aK.opacity});at.css({width:aK.portrait?aK.width:aK.height,height:aK.portrait?aK.height:aK.width});if(aK.portrait){at.removeClass("jp-landscape")}else{at.addClass("jp-landscape")}$(this).dialog("close")}}}),this.$background=$(".jp-paper-background",at),this.$paperWidth=$("#jp-paper-width",this.$dialog),this.$paperHeight=$("#jp-paper-height",this.$dialog),this.$alpha=$("#jp-alpha",this.$dialog),this.$src=$("#jp-image-src",this.$dialog);this.$paperSelect=$("#jp-paper-name",this.$dialog).change(function(){var aK=$(this).val().split(",");if(aK.length>1){j.$paperWidth.val(aK[0]);j.$paperHeight.val(aK[1]);j.setPaper()}else{j.$paperWidth.focus(function(){var aL=this;setTimeout(function(){aL.select()},10)}).focus()}}),setAlpha=function(){var aL=j.$alpha.slider("value");if(aL>0){var aK=(100-aL)/100;j.$background.css({filter:"alpha(opacity="+(100-aL)+")",opacity:aK})}else{j.$background.css({filter:"",opacity:""})}};this.$fileInput=$("#jp-file-input",this.$dialog);this.$paperWidth.add(this.$paperHeight).keydown(function(aK){if(aK.keyCode==13){j.setPaper()}}).blur(function(){j.setPaper()});this.$alpha.slider({orientation:"horizontal",range:"min",max:100,value:0,slide:setAlpha,change:setAlpha});$(".jp-orientation input",this.$dialog).change(function(){if($(this).val()=="-"){j.$orientation.addClass("jp-landscape-icon");if(!at.is(".jp-landscape")){at.css({width:at._style("height"),height:at._style("width")}).addClass("jp-landscape")}}else{j.$orientation.removeClass("jp-landscape-icon");if(at.is(".jp-landscape")){at.css({width:at._style("height"),height:at._style("width")}).removeClass("jp-landscape")}}K&&K.reposition()});this.$orientation=$(".jp-orientation",this.$dialog);var aH=$("#jp-image-src",this.$dialog);var aH=$("#jp-image-src",this.$dialog);var aI=$("#jp-file-chooser",this.$dialog);var aJ="图片文件(*.png;*.jpg;*.gif)|*.png;*.jpg;*.gif|所有文件 (*.*)|*.*";if(editorSettings.backgroundUploadService){new h(aH,aI,aJ,editorSettings.backgroundUploadService,function(aK){j.$background.attr("src","../"+aK||al)})}else{new W(aH,aI,aJ,function(aK){j.$background.attr("src",aK||al)})}}return this.$dialog};this.updateUI=function(){var aL=!at.is(".jp-landscape"),aH=$.style(at[0],"width"),aI=$.style(at[0],"height");this.oldData={portrait:aL,width:aL?aH:aI,height:aL?aI:aH,src:this.$background.attr("src"),filter:this.$background.css("filter")||"",opacity:this.$background.css("opacity")||""};var aK=parseInt(this.oldData.width)+","+parseInt(this.oldData.height);if(!$("option[value='"+aK+"']",this.$paperSelect).length){$('<option value="'+aK+'">'+this.oldData.width+"X"+this.oldData.height+"</option>").insertBefore($("option",this.$paperSelect).last())}this.$paperSelect.val(aK);this.$paperWidth.val(parseInt(this.oldData.width));this.$paperHeight.val(parseInt(this.oldData.height));var aJ=null;if(aL){this.$orientation.removeClass("jp-landscape-icon");aJ="#jp-paper-portrait"}else{this.$orientation.addClass("jp-landscape-icon");aJ="#jp-paper-landscape"}$(aJ,this.$dialog)[0].checked=true;this.$src.val(this.oldData.src==al?"":this.oldData.src);this.$alpha.slider("value",100*(1-(this.oldData.opacity||0)))};this.open=function(){var aH=this.getDialog();this.updateUI();aH.dialog("open")}}var an={settings:{},_offset:{top:0,left:0},applySettings:function(j){this.settings={};this._offset.top=0;this._offset.left=0;this.styles=null;if(j){if(j.printer){this.settings.printer=j.printer}if(j.paperWidth){this.settings.settings={paperWidth:j.paperWidth,paperHeight:j.paperHeight,orientation:j.orientation||1}}this.styles=j.styles||""}this.parseOffset()},parseOffset:function(){this._offset.top=0;this._offset.left=0;if(this.styles){var aM=/\.jp\-page\s*\{(.*?)\}/g;var aI=/\bmargin\-(top|left)\s*\:\s*([0-9\.]+)mm/g;var aK=null,j=null;while(aK=aM.exec(this.styles)){var aJ=aK[1];while(j=aI.exec(aJ)){var aL=j[1];var aH=j[2];this._offset[aL]=parseFloat(aH)}return}}},getOffsetStyle:function(){if(this._offset.left||this._offset.top){return".jatools-printing .jp-page{margin-left:{0}mm;margin-top:{1}mm}".format(this._offset.left,this._offset.top)}else{return""}},getDragCSS:function(){var j=b.sourceCodeViewer.util.getChangableStyles(".jp-page ");j.push(this.getOffsetStyle());return j.join("\n")},testPrintOut:function(){var aH={settings:$.extend({},this.settings)};aH.styles=this.getDragCSS();var j=editorSettings.getURL();if(j){aH.documents=j}O(aH)}};function o(){var j=this;this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-v-offset-dialog").dialog({autoOpen:false,height:540,width:664,buttons:{"打印看看":function(){an.testPrintOut()},"确定":function(){$(this).dialog("close")},"取消":function(){an._offset.top=j.oldval;$(this).dialog("close")}}}),this.$dialog.find("#jp-paper-offset").spinner({step:0.1,min:0,numberFormat:"n",change:function(){var aH=$("#jp-paper-up",j.$dialog)[0].checked;if(aH){an._offset.top+=$(this).val()}else{an._offset.top-=$(this).val()}}}).change(function(){var aH=$("#jp-paper-up",j.$dialog)[0].checked;if(aH){an._offset.top+=$(this).val()}else{an._offset.top-=$(this).val()}});this.$dialog.find("input:radio").change(function(aI){var aH=$("#jp-paper-up",j.$dialog)[0].checked;if(aH){j.$dialog.addClass("jp-upper-off")}else{j.$dialog.removeClass("jp-upper-off")}})}return this.$dialog};this.updateUI=function(){};this.open=function(){var aH=this.getDialog();this.updateUI();this.oldval=an._offset.top;aH.dialog("open")}}function g(){var j=this;this.getDialog=function(){if(!this.$dialog){this.$dialog=$("#jp-h-offset-dialog").dialog({autoOpen:false,height:400,width:546,buttons:{"打印看看":function(){an.testPrintOut()},"确定":function(){$(this).dialog("close")},"取消":function(){an._offset.left=j.oldval;$(this).dialog("close")}}}),this.$dialog.find("#jp-paper-offset").spinner({step:0.1,min:0,numberFormat:"n"}).change(function(){var aH=$("#jp-paper-right",j.$dialog)[0].checked;if(aH){an._offset.left-=$(this).val()}else{an._offset.left+=$(this).val()}});this.$dialog.find("input:radio").change(function(aI){var aH=$("#jp-paper-right",j.$dialog)[0].checked;if(aH){j.$dialog.addClass("jp-right-off")}else{j.$dialog.removeClass("jp-right-off")}})}return this.$dialog};this.updateUI=function(){};this.open=function(){var aH=this.getDialog();this.updateUI();this.oldval=an._offset.left;aH.dialog("open")}}function ax(){var j=this;this.editor=$("<input class='jp-inplace-editor' type='text'></input>");this.mousedown=function(aH){if(j.editor[0]!=aH.target){j.close()}};this.keydown=function(aH){if(aH.keyCode==13){j.close()}};this.close=function(){var aI=$(this.target).find(".jp-text-content");var aK=$(this.editor).val();if(this.isText&&!aK.match(/^[\s]*$/)){aK="${"+aK+"}"}var aH=aI.text();aI.text(aK);var aJ=aI.text();if(aJ!=aH){ao.add(new v(aI,["text"],aH,aJ))}$(this.target).removeClass("jp-inplace-editing");$(document).unbind("mousedown",this.mousedown);this.editor.unbind("keydown",this.keydown).remove();this.target=null};this.open=function(aH){this.target=aH;this.isText=$(aH).is(".jp-text");$(aH).addClass("jp-inplace-editing");var aJ=$(".jp-text-content",aH).text();var aI=aJ.match(/^\$\{([^}]*)[}]$/);if(aI){aJ=aI[1]}this.editor.appendTo(aH).css({"font-size":$(aH).css("font-size"),"font-family":$(aH).css("font-family"),"text-align":$(aH).css("text-align")}).val(aJ).focus();$(document).bind("mousedown",this.mousedown);this.editor.bind("keydown",this.keydown);return null}}function aG(){var j=this;this.dialogCache={};this.bar_1d=["code39","code93","2of5","code128","code128a","code128b","code128c","ean13"];this.defaults={"bar-1d":{type:"none",rotate:"0",background:null,"bar-color":"#000","space-color":null,"show-text":"true","text-color":"#000","font-size":"11","font-name":"Arial",autofit:"false"},pdf417:{type:"none","err-level":"","data-rows":"","data-cols":"",background:null,"bar-color":"#000","space-color":null},qr:{type:"none",version:"",background:null,"bar-color":"#000","space-color":null},datamatrix:{type:"none","mod-height":"","mod-width":"",background:null,"bar-color":"#000","space-color":null}};this.getGroup=function(aH){return $.inArray(aH,this.bar_1d)>-1?"bar-1d":aH},this.close=function(){},this.parseData=function(aL){var aK=$(aL).data("jp-barcode-data");if(!aK){var aK={};var aJ=$(aL)._object()._codeData()._codestyle.split(";");for(var aH=0;aH<aJ.length;aH++){var aI=aJ[aH].split(":");aK[aI[0]]=aI[1]}aK=$.extend({},this.defaults[this.getGroup(aK.type)],aK);$(aL).data("jp-code-data",aK)}return aK},this.apply=function(aL,aJ){var aI=[],aK=this.defaults[this.getGroup(aJ.type)];for(p in aJ){var aH=aJ[p];if(aH!=aK[p]&&aH){aI.push(p+":"+aH)}}var aM=$(aL)._object()._codeData();aM._codestyle=aI.join(";");$(aL)._object()._codeData(aM)},this.updateUI=function(aH){if(!this.updating){this.updating=true;this.$dialog.find(".jp-code-ui").each(function(){var aK=$(this).attr("name");if($(this).is(".jp-color-chooser")){$(this).spectrum("set",aH[aK]||"rgba(255, 255, 255,0)")}else{if($(this).is(":radio")&&(this.id==="jp-"+$(this).attr("name")+"-"+aH[aK])){this.checked=true}else{if($(this).is(":checkbox")){this.checked=aH[aK]===$(this).val()}else{if(this.id=="jp-qr-version"||this.id=="jp-qr-version-2"){$(this).val("");var aJ=$(this).is("#jp-qr-version")?0:1;if(aH.version){var aI=aH.version.split("-")[aJ].toLowerCase();$(this).val(aI=="auto"?"":aI)}}else{if(aK=="moudles"){if(aH["mod-height"]){$(this).val(aH["mod-height"]+"x"+aH["mod-width"])}else{$(this).val("")}}else{if($(this).is("select")&&aH[aK]){$(this).val(aH[aK])}}}}}}});this.updating=false}},this.updateData=function(){var aH=$.extend({},this.$target.data("jp-code-data"));this.$dialog.find(".jp-code-ui").each(function(){var aJ=$(this).attr("name");if($(this).is(".jp-color-chooser")){aH[aJ]=$(this).val()=="transparent"?null:$(this).val()}else{if($(this).is(":radio")&&this.checked){aH[aJ]=$(this).val()}else{if($(this).is(":checkbox")){aH[aJ]=this.checked+""}else{if($(this).is("select.qr-version")){var aK=($("#jp-qr-version",this.$dialog).val()||"auto")+"-"+($("#jp-qr-version-2",this.$dialog).val()||"auto");if(aK=="auto-auto"){aK=""}aH.version=aK}else{if(aJ=="moudles"){var aI=$(this).val().split("x");aH["mod-height"]=aI.length?aI[0]:"";aH["mod-width"]=aI.length?aI[1]:""}else{if($(this).is("select")){aH[aJ]=$(this).val()}}}}}}});this.$target.data("jp-code-data",aH);return aH},this.getDialog=function(aH){var aK=this.getGroup(aH),aJ=this;if(!this.dialogCache[aK]){var aI=$("#jp-"+aK+"-dialog");k($(".jp-color-chooser",aI));af($("#jp-font-name",this.$dialog));$(".jp-code-ui",aI).change(function(aL){if(!aJ.updating){aJ.apply(aJ.$target,aJ.updateData())}});$("#jp-show-text",aI).change(function(){$(this).closest("p").nextAll().css("display",this.checked?"block":"none")});this.dialogCache[aK]=aI}return this.dialogCache[aK]},this.open=function(aJ){var aH=this;this.$target=$(aJ);this.$dialog&&this.$dialog.dialog("close");this.oldval=$.extend({},$(aJ)._object()._codeData());var aI=this.parseData(aJ);this.$dialog=this.getDialog(aI.type);this.updateUI(aI);if($("#jp-show-text",this.$dialog).length){$("#jp-show-text",this.$dialog).closest("p").nextAll().css("display",$("#jp-show-text",this.$dialog)[0].checked?"block":"none")}this.$dialog.dialog({width:420,buttons:{"确定":function(){var aL=aH.$target._object()._codeData();var aK=["_codeData"];ao.add(new v(aH.$target._object(),aK,aH.oldval,aL));$(this).dialog("close")},"取消":function(){aH.$target._object()._codeData(aH.oldval);$(this).dialog("close")}}});return this.$dialog}}function M(){var j=this;this.close=function(){},this.open=function(aL){this.$target=$(aL);if(!this.$dialog){this.$dialog=$("#jp-image-dialog").dialog({width:510,autoOpen:false,buttons:{"确定":function(){var aP=$(".jp-image-view",j.$target);ao.open();ao.add(new v(aP,["attr","src"],j.lastVal.src,aP.attr("src")));var aQ=aP.is(".jp-auto-stretch");if(aQ!==j.lastVal.stretched){if(aQ){ao.add(new v(aP,[function(){this.target.removeClass("jp-auto-stretch")},function(){this.target.addClass("jp-auto-stretch")}]))}else{ao.add(new v(aP,[function(){this.target.addClass("jp-auto-stretch")},function(){this.target.removeClass("jp-auto-stretch")}]))}}ao.close();$(this).dialog("close")},"取消":function(){if(j.lastVal.stretched){$(".jp-image-view",j.$target).addClass("jp-auto-stretch")}else{$(".jp-image-view",j.$target).removeClass("jp-auto-stretch")}$(".jp-image-view",j.$target).attr("src",j.lastVal.src);$(this).dialog("close")}}});var aO=function(){$(".jp-image-view",j.$target).attr("src",aH.val()||al);if(aN[0].checked){$(".jp-image-view",j.$target).removeClass("jp-auto-stretch")}else{$(".jp-image-view",j.$target).addClass("jp-auto-stretch")}};var aH=$("#jp-image-src",this.$dialog);var aI=$("#jp-file-chooser",this.$dialog);var aK="图片文件 (*.png;*.jpg;*.gif)|*.png;*.jpg;*.gif|所有文件 (*.*)|*.*";new W(aH,aI,aK,aO);var aN=$("#jp-original-size",this.$dialog).change(aO)}var aM=$(".jp-image-view",this.$target).attr("src")||"";$("#jp-image-src",this.$dialog).val(aM==al?"":aM);var aJ=$(".jp-image-view",this.$target).is(".jp-auto-stretch");$("#jp-original-size",this.$dialog)[0].checked=!aJ;this.lastVal={src:aM,stretched:aJ};return this.$dialog.dialog("open")}}function ae(){var j=this;this.open=function(aI,aH){this.callok=aH;if(!this.$dialog){this.$dialog=$("#jp-template-save-dialog").dialog({width:400,autoOpen:false,buttons:{"确定":function(){if(j.callok){if(j.callok($(this).find("#jp-settings-id").val())){$(this).dialog("close")}}else{$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}}})}this.$dialog.find("#jp-settings-id").val(aI||"");return this.$dialog.dialog("open")}}function av(aH){var j=$(aH).data("code-data");if(!j){j=$(aH).data()}}function l(aH){var j=b.newBarcode.replace(/\$\{(.*?)\}/g,function(aJ,aI){return aH[aI]});return $(j)}function ay(){this.decode=function(aH,aK){var aJ=this;$(".jp-component",at).remove();ao.clear();var j=aH._style("width"),aI=aH._style("height");j&&at.css("width",j);aI&&at.css("height",aI);at._copyClass(aH,"jp-landscape").removeClass("jp-hidden");at.find(".jp-paper-background").attr("src",al);aH.children().each(function(aN){for(e in aJ.decoders){if($(this).is(e)){var aM=aJ.decoders[e].call(aJ,$(this),aN,aK);if(aM){c(aM.appendTo(at)._copyCss($(this),["left","top","width","height"])._uClass($(this)._uClass()),true);var aL=$(this)._border();if(aL&&aL.border!=""){$(aM).css(aL)}}return}}});K&&K.reposition()},this.decoders={".jp-paper-background":function(j,aJ,aH){var aI=j.attr("src");if(aI){if(aH){aI=P().getAbsoluteURL(aI,aH)}}else{aI=al}$(".jp-paper-background",at).attr("src",aI)._copyCss(j,["filter","opacity"])},".jp-label":function(aH,aI){var j=$(b.newLabel);$(".jp-text-content",j).text(aH.text());return j._copyCss(aH,["font-family","font-weight","font-style","text-decoration","font-size","color","background-color","text-align","z-index"])},".jp-text":function(j,aI){var aH=$(b.newText);$(".jp-text-content",aH).text(j.text());return aH._copyCss(j,["font-family","font-weight","font-style","text-decoration","font-size","color","background-color","text-align","z-index"])},".jp-barcode":function(j,aI){var aH=l(j._object()._codeData());return aH._copyCss(j,["background-color","z-index"])},".jp-image":function(j,aM,aK){var aL=j.attr("src");if(aL){if(aK){aL=P().getAbsoluteURL(aL,aK)}}else{aL=al}var aJ=$(b.newImage),aI=j.find("img"),aH=aJ.find("img").attr("src",aL)._copyClass(aI,"jp-auto-stretch");return aJ._copyCss(j,["background-color","z-index"])}},this.encoders={".jp-paper-background":function(j,aI){if(j.attr("src")==al){return null}else{var aH=j.attr("src");return{style:j.attr("style"),comp:$('<img class="jp-paper-background screen-only">').attr("src",aH)}}},".jp-label":function(j,aI){var aH=$(".jp-text-content",j).text();return{style:j.attr("style"),comp:$('<div class="jp-label jp-comp-'+aI+'">').text(aH)}},".jp-text":function(j,aI){var aH=$(".jp-text-content",j).text();return{style:j.attr("style"),comp:$('<div class="jp-text jp-comp-'+aI+'">').text(aH)}},".jp-barcode":function(j,aL,aK){var aH='<object classid="CLSID:E5A01FF5-FC6E-42F3-AF48-DEA5777DED62" ><param name="_code" value="${_code}"/><param name="_codestyle" value="${_codestyle}"/><embed type="application/x-vnd.jatoolsCoder" _code="${_code}" _codestyle="${_codestyle}"></embed></object>';var aJ=j._object()._codeData();var aH=aH.replace(/\$\{(.*?)\}/g,function(aN,aM){return aJ[aM]});var aI=$(aH);aI.find("embed")._codeData(j._object()._codeData());if(!aK){aI.find("embed").remove()}return{style:j.attr("style"),comp:$('<div class="jp-barcode jp-comp-'+aL+'">').append(aI)}},".jp-image":function(aH,aJ){var j=$("img",aH);var aI=$(j[0].cloneNode());if(aI.attr("src")==al){aI.attr("src","")}return{style:aH.attr("style"),comp:$('<div class="jp-image jp-comp-'+aJ+'">').append(aI)}}},this.headObject=function(){return'<OBJECT ID="jatoolsPrinter" CLASSID="CLSID:B43D3361-D075-4BE2-87FE-057188254255" codebase="jatoolsPrinter.cab#version=5,7,0,0"></OBJECT>'};this.bodyObject=function(){return['<object id="ojatoolsPrinter" codebase="jatoolsPrinter.cab#version=5,4,0,0"','	classid="clsid:B43D3361-D075-4BE2-87FE-057188254255" width="0" height="0">','	<embed id="ejatoolsPrinter" type="application/x-vnd.jatoolsPrinter" width="0" height="0"></embed>',"</object>"].join("\n")};this.debugButtons=function(j){return["<div>",'<input type="button" value="打印预览..." onClick="doPrint(\'打印预览...\')">','<input type="button" value="打印..." onClick="doPrint(\'打印...\')">','<input type="button" value="打印" onClick="doPrint(\'打印\')">','<span style="font-size:12px;color:gray;margin-left:20px;">'+(j?"本网页代码可以在IE,Firefox,Chrome,Safari 上打印.":"本网页代码只可以在IE上打印噢.")+"</span>","</div>"].join("\n")},this.debugScript=function(j){var aH=n();return["<script>","function doPrint(how){","	var myDoc={","		settings:{","			paperWidth:"+aH.settings.paperWidth+",","			paperHeight:"+aH.settings.paperHeight+",","			orientation:"+aH.settings.orientation,"		},","		marginIgnored:true,","		enableScreenOnlyClass:true,","		documents:document,","		copyrights:'杰创软件拥有版权  www.jatools.com'","	};",j?"	var jatoolsPrinter = navigator.userAgent.indexOf('MSIE') > -1 ? document.getElementById('ojatoolsPrinter'): document.getElementById('ejatoolsPrinter');":"","	if(how=='打印预览...')","		jatoolsPrinter.printPreview(myDoc);","	else if(how=='打印...')","		jatoolsPrinter.print(myDoc,true);","	else","		jatoolsPrinter.print(myDoc,false);","}","<\/script>"].join("\n")};this.getChangableStyles=function(aI){var j=[],aH=this;at.children().each(function(){for(e in aH.encoders){if($(this).is(e)){var aK=aH.encoders[e].call(aH,$(this),0,true);if(aK){if(aK.style){var aJ=$(this)._uClass();if(aJ){j.push(aI+"."+aJ+"{"+aK.style+"}")}}}}}});return j},this.applyUClass=function(){var aH=[];var j=[];at.children().each(function(){var aI=$(this)._uClass();if(aI){aH[aI]=true}else{j.push($(this))}});$.each(j,function(aK,aJ){for(var aK=0;true;aK++){var aI="jp-comp-"+aK;if(!aH[aI]){$(this)._uClass(aI);aH[aI]=1;break}}})};this.encodeTemplate=function(){var aJ=this;var aI=$('<div id="page${pageNo}" class="jp-page">').css({width:at._style("width"),height:at._style("height")})._copyClass(at,"jp-landscape");var j=0;var aH=[];this.applyUClass();at.children().each(function(){for(e in aJ.encoders){if($(this).is(e)){var aM=aJ.encoders[e].call(aJ,$(this),j,true);if(aM){var aK=$(this)._uClass();var aL=aM.comp._uClass();if(aL){aM.comp.removeClass(aL).addClass(aK)}aI.append(aM.comp);if(aM.style){aH.push("."+aK+"{"+aM.style+"}")}j++}}}});return{styles:[".jp-page{position:relative}",".jp-text,.jp-label,.jp-image,.jp-barcode{position:absolute;overflow:hidden}",".jp-auto-stretch,.jp-barcode object,.jp-barcode embed{width: 100%; height: 100%;}",".jp-paper-background{position:absolute;width:100%;height:100%;}",A(aH.join("\n"))].join("\n"),pageBody:aI._outerHTML().replace(/\<param\s*[^>]*\>/g,"")}};this.encode=function(aH,j){var aL=this;var aK=$('<div id="page1" class="jp-page">').css({width:at._style("width"),height:at._style("height")})._copyClass(at,"jp-landscape");var aI=0;var aJ=[];at.children().each(function(){for(e in aL.encoders){if($(this).is(e)){var aM=aL.encoders[e].call(aL,$(this),aI,j);if(aM){aK.append(aM.comp);if(aM.style){aJ.push(".jp-comp-"+aI+"{"+aM.style+"}")}aI++}}}});return["<html>","<head>","<title>jatoolsPrinter打印</title>",'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">',((!j)&&aH)?this.headObject():"","<style>",".jp-page{position:relative}",".jp-text,.jp-label,.jp-image,.jp-barcode{position:absolute;overflow:hidden}",".jp-auto-stretch,.jp-barcode object,.jp-barcode embed{width: 100%; height: 100%;}",".jp-paper-background{position:absolute;width:100%;height:100%;}",A(aJ.join("\n")),"</style>",aH?this.debugScript(j):"","</head>","<body>",aH?this.debugButtons(j):"",aK.appendTo(document.body)._outerHTML(),(j&&aH)?this.bodyObject():"","</body>","</html>"].join("\n")}}function R(){var j=this;this.util=new ay();this.close=function(){},this.setCode=function(aI,aJ){var aH=new SyntaxHighlighter.HtmlScript("js");aH.init({toolbar:false,brush:"htmlscript"});X(this.util.encode(aI,aJ),function(aK){$("#jp-plain-code",j.$dialog).val(aK);aK=aH.getHtml(aK.replace(/</g,"&lt;").replace(/>/g,"&gt;"));aK=aK.replace(/([$][{][^}]*[}])/gm,"<span class='jp-expression'>$1</span>");$("#jp-code",j.$dialog).html(aK);j.$dialog.dialog("open").find(".syntaxhighlighter").scrollLeft(0)})};this.open=function(){if(!this.$dialog){$("#jp-source-code-dialog").find(".jp-button-set").buttonset();this.$dialog=$("#jp-source-code-dialog").dialog({width:610,autoOpen:false});$("#jp-copy-code",this.$dialog).click(function(){D($("#jp-plain-code",j.$dialog).val())});$("#jp-save-code",this.$dialog).click(function(){aD($("#jp-plain-code",j.$dialog).val())});$("input:checkbox",this.$dialog).change(function(){var aJ=$("#jp-debug-code",j.$dialog)[0].checked;var aK=$("#jp-cross-browser",j.$dialog)[0].checked;j.setCode(aJ,aK)})}var aH=$("#jp-debug-code",this.$dialog)[0].checked;var aI=$("#jp-cross-browser",this.$dialog)[0].checked;this.setCode(aH,aI);return this.$dialog}}function aA(){var j=this;this.reposition=function(){var aI=Math.min($(window).width()-220,$(".jp-page").width()+15);var aH=this.$dialog.dialog("option","position",[aI,45]).dialog("option","height");if(this.$dialog.height()>$(window).height()){this.$dialog.dialog("option","height",$(window).height())}};this.create=function(aJ,aL){var aK=aJ.expr||"${"+aJ.text+"}";var aH="new"+aJ.type.charAt(0).toUpperCase()+aJ.type.slice(1);var aI=null;if(aJ.type=="barcode"){aI=l({_code:aK,_codestyle:"type:"+aJ.codetype+";autofit:true"}).attr("title",aK);aI.css({width:100,height:100})}else{aI=$(b[aH])}$s().unselect();c(aI.appendTo(at).offset(aL).select());if(aJ.type=="label"){if(aJ.text=="+"){G.edit(aI)}else{aI.find(".jp-text-content").text(aJ.expr||aJ.text)}}else{if(aJ.type=="text"){aI.find(".jp-text-content").text(aK)}else{if(aJ.type=="image"){aI.find("img").attr("src",aK);aI.css({width:100,height:100})}}}ao.add(new v(aI,["_appendTo"],null,at))};this.open=function(){this.$dialog=$("#jp-comp-list-dialog");this.$panel=this.$dialog.find("#jp-comp-list");$.each(editorSettings.fields,function(aJ,aK){j.$panel.append($('<li><a href="#">'+(aK.text||"")+"</a></li>").data("jp-field-data",aK))});$("li",this.$dialog).draggable({appendTo:at,helper:"clone"});var aI=Math.min($(window).width()-220,$(".jp-page").width()+15);this.$dialog.dialog({top:50,position:[aI,45],width:210,autoOpen:true});var aH=this.$dialog.dialog("option","height");if(this.$dialog.height()>$(window).height()){this.$dialog.dialog("option","height",$(window).height())}$(window).resize(function(){j.reposition()});at.droppable({accept:"#jp-comp-list li",drop:function(aJ,aK){var aL=$(this).find("li.ui-draggable-dragging").offset();j.create(aK.draggable.data("jp-field-data"),aL)}});return this}}var at=$(".jp-page");var aw=new ax();var F=new aG();function x(j){if(au&&$(j.target).closest(".jp-page").add($(j.target).closest("a.jp-creating")).length==0){d()}}function n(){var aL={settings:{},marginIgnored:true,enableScreenOnlyClass:true,logPage:true,copyrights:"杰创软件拥有版权  www.jatools.com"};var aJ=aL.settings;var aM=!at.is(".jp-landscape"),j=$.style(at[0],"width"),aI=$.style(at[0],"height"),aH=aM?j:aI,aK=aM?aI:j;aJ.paperWidth=parseInt(aH)*10;aJ.paperHeight=parseInt(aK)*10;aJ.orientation=aM?1:2;return aL}function aE(j){au&&d();j.closest("a").add($(document.body)).addClass("jp-creating");$(document).one("mousedown",x);$(".ui-draggable",at).each(function(){$(this).data("draggable").options.disabled=true})}function d(){au=null;$(".ui-draggable",at).each(function(){$(this).data("draggable").options.disabled=false});$(".jp-creating").removeClass("jp-creating");$(document).unbind("mousedown",x)}function Z(aJ,aI){var j=["borderStyle"],aH=[];aJ.vals(j,aH).borderStyle(aI);ao.add(new v(aJ,j,aH,aI));return aJ}function ah(){var j=$("#jp-ax");var aH=j.contents()[0];aH.open();aH.writeln(["<html>","   <body>",'      <object id="ojatoolsPrinter" codebase="jatoolsPrinter.cab#version=5,4,0,0"','         classid="clsid:B43D3361-D075-4BE2-87FE-057188254255" width="0" height="0">','         <embed id="ejatoolsPrinter" type="application/x-vnd.jatoolsPrinter" width="0" height="0" />',"      </object>","   </body>","</html>"].join("\n"));aH.close()}function O(j){var aJ=n();if(!j||!j.documents){var aH=$("#jp-for-print",document.body);if(!aH.length){aH=$('<iframe id="jp-for-print" class="jp-html-loader"><iframe>')}$(document.body).append(aH);var aI=aH.contents()[0];aI.open();aI.writeln(b.sourceCodeViewer.util.encode(false,!$.browser.msie));aI.close();aJ.documents=aI}if(j){$.extend(true,aJ,j)}P().printPreview(aJ)}var b={"copied-flag":"jp-component-copied:","copied-flag-test":/^jp\-component\-copied\:/,paperEditor:new ak(),sourceCodeViewer:new R(),newLabel:"<div class='jp-label jp-component'><span class='jp-text-content'></span><p class='jp-selected-layer'></p></div>",newText:"<div class='jp-text jp-component'><span class='jp-text-content'></span><p class='jp-selected-layer'></p></div>",newBarcode:'<div class="jp-barcode jp-component" ><p class="jp-selected-layer"></p>'+(($.browser.msie)?('<OBJECT windowless="true" classid=CLSID:E5A01FF5-FC6E-42F3-AF48-DEA5777DED62 ><param name="_code" value="${_code}"></param><param name="_codestyle" value="${_codestyle}"></param></OBJECT>'):('<embed _code="${_code}" _codestyle="${_codestyle}" type="application/x-vnd.jatoolsCoder"  windowless="true"></embed>'))+"</div>",newImage:"<div class='jp-image jp-component'><img class='jp-image-view' src='"+al+"'></img><p class='jp-selected-layer'></p></div>","jp-new":function(){this.paperEditor.open()},"jp-v-offset":function(){if(!this.paperVerticalOffsetDialog){this.paperVerticalOffsetDialog=new o()}this.paperVerticalOffsetDialog.open()},"jp-h-offset":function(){if(!this.paperHorizonOffsetDialog){this.paperHorizonOffsetDialog=new g()}this.paperHorizonOffsetDialog.open()},"jp-open":function(){r()},"jp-save":function(){this.sourceCodeViewer.open()},"jp-print":function(){if(editorSettings.getURL()){if(editorSettings.type==2){var j=b.sourceCodeViewer.util.encodeTemplate();j.settingsID=editorSettings.settingsID+".tmp";j.how="upload";$.post(editorSettings.templateService,j,function(aH){an.testPrintOut()})}else{an.testPrintOut()}}else{O()}},"jp-undo":function(){ao.undo()},"jp-redo":function(){ao.redo()},"jp-delete":function(j){ao.add(new v($s(),["_removeFrom"],null,at));$s().remove()},"jp-copy":function(aH){var j=$s().clone();j.find(".ui-resizable-handle").remove();D(this["copied-flag"]+$("<div>").append(j)._outerHTML())},"jp-cut":function(j){ao.add(new v($s(),["_removeFrom"],null,at));this["jp-copy"].call(this);$s().remove()},"jp-paste":function(aI){var aH=u()||"";if(aH.match(this["copied-flag-test"])){$s().unselect();var j=$(aH.substring(this["copied-flag"].length)).children().each(function(aJ,aM){if($(this).is(".jp-barcode")){var aK=$(this)._object();if(($.browser.msie&&aK.is("embed"))||((!$.browser.msie)&&aK.is("object"))){var aL=l(aK._codeData())._object();$(this).append(aL);aK.remove()}}$(this).removeClass("ui-selected jp-ininted ui-draggable ui-resizable")});j=c(j.appendTo(at).animate({left:"+=5",top:"+=5"},0).select());ao.add(new v(j,["_appendTo"],null,at))}},"jp-font":function(j){$s()._css("font-family",$(j.target).val())},"jp-bold":function(aH){var j=$(aH.target)[0].checked?"700":"normal";$s()._css("font-weight",j)},"jp-italic":function(j){var aH=$(j.target)[0].checked?"italic":"normal";$s()._css("font-style",aH)},"jp-color":function(j){},"jp-background":function(j){},"jp-underline":function(aH){var j=$(aH.target)[0].checked?"underline":"none";$s()._css("text-decoration",j)},"jp-align-left":function(j){$s()._css("text-align",$(j.target).val())},"jp-align-center":function(j){$s()._css("text-align",$(j.target).val())},"jp-align-right":function(j){$s()._css("text-align",$(j.target).val())},"jp-new-label":function(j){aE($(j.target));au=$(this.newLabel)},"jp-new-text":function(j){aE($(j.target));au=$(this.newText)},"jp-new-barcode":function(aH){var j=$(aH.target).attr("code-type");aE($(aH.target));au=l({_code:j=="2of5"?"1234567":"6938012345670",_codestyle:"type:"+j+";autofit:true"})},"jp-new-image":function(j){aE($(j.target));au=$(this.newImage)},"jp-font-size":function(aK){var aI=[],aJ=[],j=["css","font-size"];var aH=aK?-2:2;$s().vals(j,aI).each(function(){var aL=(parseInt($(this).css("font-size"))+aH)+"px";$(this).css({"font-size":aL})}).vals(j,aJ);ao.add(new v($s(),j,aI,aJ))},"jp-size-up":function(j){this["jp-font-size"].call(this,false)},"jp-size-down":function(j){this["jp-font-size"].call(this,true)},"jp-front":function(aJ){if($s().length==1){var aI=$s()[0],j=[],aH={};$(".jp-component",at).each(function(aL){var aK=$(this).css("z-index");j.push(aK);aH[aK]=this}).each(function(){if(aI==this){j.sort();var aM=$(this).css("z-index");var aL=$.inArray(aM,j);if(aL<j.length-1){var aN=j[aL+1];var aK=aH[aN];ao.open();$(aI)._css("z-index",aN);$(aK)._css("z-index",aM);ao.close()}}})}},"jp-back":function(aJ){if($s().length==1){var aI=$s()[0],j=[],aH={};$(".jp-component",at).each(function(aL){var aK=$(this).css("z-index");j.push(aK);aH[aK]=this}).each(function(){if(aI==this){j.sort();var aM=$(this).css("z-index");var aL=$.inArray(aM,j);if(aL>0){var aN=j[aL-1];var aK=aH[aN];ao.open();$(aI)._css("z-index",aN);$(aK)._css("z-index",aM);ao.close()}}})}},"jp-top":function(aJ){if($s().length==1){var aI=$s()[0],j=[],aH={};$(".jp-component",at).vals(["css","z-index"],j);$(aI)._css("z-index",Math.max.apply(null,j)+1)}},"jp-bottom":function(aJ){if($s().length==1){var aI=$s()[0],j=[],aH={};$(".jp-component",at).vals(["css","z-index"],j);$(aI)._css("z-index",Math.min.apply(null,j)-1)}},"jp-border-1px":function(j){Z($s(),{border:"solid 1px black"})},"jp-border-no":function(j){Z($s(),{border:""})},"jp-border-custom":function(aM){var aI=$("#jp-border-dialog"),j=$s();if(!aI.is(".ui-dialog-content")){aI.find(".jp-button-set").buttonset();var aH=$("#jp-border-viewer",aI),aP=$("#jp-line-viewer",aI),aK={"jp-border-none":function(){aH.css("border","")},"jp-border-all":function(){aH.css("border",aP._border()["border-top"])},"jp-border-left":function(){aH.css("border-left",aP._border()["border-top"])},"jp-border-top":function(){aH.css("border-top",aP._border()["border-top"])},"jp-border-right":function(){aH.css("border-right",aP._border()["border-top"])},"jp-border-bottom":function(){aH.css("border-bottom",aP._border()["border-top"])},"jp-border-style-1px":function(){aP.css("border-top-width","1px")},"jp-border-style-2px":function(){aP.css("border-top-width","2px")},"jp-border-style-3px":function(){aP.css("border-top-width","3px")},"jp-border-style-4px":function(){aP.css("border-top-width","4px")},"jp-border-style-5px":function(){aP.css("border-top-width","5px")},"jp-border-style-6px":function(){aP.css("border-top-width","6px")},"jp-border-style-solid":function(){aP.css("border-top-style","solid")},"jp-border-style-dashed":function(){aP.css("border-top-style","dashed")},"jp-border-style-dotted":function(){aP.css("border-top-style","dotted")}};aI.dialog({autoOpen:false,width:425,height:390,buttons:{"确定":function(){var aQ=aH._border();if($s().length){Z($s(),aQ)}$(this).dialog("close")},"取消":function(){$(this).dialog("close")}}});$(".jp-border-previewer",aI).click(function(aQ){$.each([".border-top",".border-right",".border-bottom",".border-left"],function(aR,aT){if($(aQ.target).is(aT)){var aS=aT.substring(1);old=$.style(aH[0],aS)||$.style(aH[0],"border");aH.css(aS,old?"":$.style(aP[0],"border-top"))}})});$(".jp-border-command a").click(function(aQ){var aR=$(this)[0].id;aK[aR]&&aK[aR]()});k($("#jp-border-color",aI),null,function(aQ){aP.css("border-top-color",aQ.toHexString())})}var aJ=$("#jp-line-viewer",aI),aN=$("#jp-temp",aI).borderStyle($s().first().borderStyle())._border(),aL=null;for(p in aN){if(!aN[p].match(/^none.*/)){aL=aN[p];break}}aJ.css("border-top",aL||"solid 1px black");var aO=$("#jp-border-viewer",aI).borderStyle($s().first().borderStyle());$("#jp-border-viewer",aI).borderStyle($s().first().borderStyle());aI.dialog("open")}};function af(aJ){try{var aK=P().getFonts();if(aK){var aH=$(aJ)[0];for(var j=0;j<aK.length;j++){aH.options[j]=new Option(aK[j],aK[j])}}}catch(aI){}}var B={"ctrl+c":{cmd:"jp-copy",enabled:5},"ctrl+x":{cmd:"jp-cut",enabled:5},"ctrl+v":{cmd:"jp-paste",enabled:5},"ctrl+z":{cmd:"jp-undo",enabled:7},"ctrl+y":{cmd:"jp-redo",enabled:7},"ctrl+]":{cmd:"jp-size-up",enabled:7},"ctrl+[":{cmd:"jp-size-down",enabled:7},"ctrl+PgUp":{cmd:"jp-front",enabled:7},"ctrl+PgDn":{cmd:"jp-back",enabled:7},"ctrl+End":{cmd:"jp-bottom",enabled:7},"ctrl+Home":{cmd:"jp-top",enabled:7},"46":{cmd:"jp-delete",enabled:5},forView:function(j){for(e in this){if(this[e].enabled){this[e].enabled&=j}}}};var J={"33":"PgUp","34":"PgDn","35":"End","36":"Home","219":"[","221":"]"};$(document).keydown(function(aH){if(!$(aH.target).is("input")){var j=null;if(aH.ctrlKey){j="ctrl+"+(J[aH.keyCode+""]||String.fromCharCode(aH.keyCode).toLowerCase())}else{if(aH.keyCode==46){j=aH.keyCode+""}}if(j&&B[j]&&B[j].enabled){j=B[j].cmd;b[j]&&b[j].call(b);aH.preventDefault();return false}}});var aj=null;function k(aH,j,aI){$(aH).each(function(aL){var aK=this;var aJ={showInitial:true,showPalette:true,showSelectionPalette:true,maxPaletteSize:10,preferredFormat:"hex",cancelText:"取消",chooseText:"确定",localStorageKey:"spectrum.demo",palette:[["rgba(255, 255, 255,0)","rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(255, 255, 255)"].slice($(this).is(".jp-with-transparent")?0:1),["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"]],change:function(aM,aN){aI&&aI(aM,aN)},show:function(){aj=aK},hide:function(){aj=null}};j&&(aJ=$.extend(j,aJ));$(this).spectrum(aJ)})}var ab=function(j,aH){$s()._css(aH.style,j.alpha?j.toHexString():"transparent")};function am(j){return("0"+parseInt(j).toString(16)).slice(-2)}function A(j){return j.replace(/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(aI,aK,aJ,aH){return"#"+am(aK)+am(aJ)+am(aH)})}k($("#jp-color"),{style:"color"},ab);k($("#jp-background"),{style:"background-color"},ab);$.ui.plugin.add("resizable","rulerSet",{resize:function(j,aN){var aM=$(aN.helper),aK=aM.data("resizable"),aL=aK.size;var aJ=aM.data("oldVals");aL.width+=aJ.dx;aL.height+=aJ.dy;var aH=aM.data("connectors").slice(0);aH[1]=aH[0]+Math.round(aL.width/2);aH[2]=aH[0]+aL.width;aH[4]=aH[3]+Math.round(aL.height/2);aH[5]=aH[3]+aL.height;siblingConnectors=aM.data("sibling-connectors");var aI=function(aQ,aR,aP,aS){var aT=(aS-aP)==2?1:2;aK.size[aP?"height":"width"]=(aR-aQ[aP])*aT-(aP?aJ.dy:aJ.dx)};var aO=V(aH,siblingConnectors,[2,1],[5,4],aI);aM.data("rulers",aO)}});var aF=function(aJ){var aI=$(aJ).offset(),j=$(aJ).outerWidth(),aH=$(aJ).outerHeight();return[aI.left,aI.left+Math.round(j/2),aI.left+j,aI.top,aI.top+Math.round(aH/2),aI.top+aH,j,aH,$(aJ)]};var ad=function(aH){var j=[];$(".ui-draggable",at).each(function(){var aK=$(this).offset();var aJ=$(this).data("connectors");if(true||!aJ){aJ=aF(this);$(this).data("connectors",aJ)}var aI=$(this).data("connector");if(!aI){aI=$('<p class="jp-connector jp-ruler-element"></p>').appendTo($(aH).parent());$(this).data("connector",aI);$(this).data("connector2",$('<p class="jp-connector jp-ruler-element"></p>').appendTo($(aH).parent()))}aI.offset({left:aJ[1]-3,top:aJ[4]-3});if(this!=aH){j.push(aJ)}else{$(aH).data("sibling-connectors",j)}})};var y=function(aI,aH){var j=aF(aI);$.each(aH,function(aM){var aK=j[this.from[1]];var aN=j[this.from[2]];$(aI).data(aM?"connector2":"connector").css("display","block").offset({left:aK-3,top:aN-3});var aO=this.to[0].data("connectors");var aJ=aO[this.to[1]];var aL=aO[this.to[2]];this.to[0].data("connector").css("display","block").offset({left:aJ-3,top:aL-3});if(this.name=="h"){$(".jp-h-ruler").css({width:Math.abs(aK-aJ),display:"block"}).offset({left:Math.min(aK,aJ),top:aL})}else{$(".jp-v-ruler").css({height:Math.abs(aN-aL),display:"block"}).offset({left:aJ,top:Math.min(aN,aL)})}})};var q=function(aN,aL,aR,aQ,aH){var aJ=Number.MAX_VALUE,aU=[];var aI=(aR==1)?aH+1:aH;var j=(aQ==1)?aH+1:aH;var aP=(aR==1)?aI+1:aH+3;var aO=(aQ==1)?j+1:aH+3;for(var aM=aI;aM<aP;aM++){var aT=aN[aM];for(var aK=j;aK<aO;aK++){var aS=aL[aK];if(Math.abs(aS-aT)<aJ){aU[0]=aM;aU[1]=aK;aJ=Math.abs(aS-aT)}}}return aU};var V=function(j,aK,aJ,aI,aN){$(".jp-ruler-element").css("display","none");var aH=false;var aM=false;var aL=[];$.each(aK,function(){var aO=this;$.each(aI,function(aP,aR){var aQ=j[aR],aS=aR;$.each([4,5,3],function(aU,aW){var aT=aO[aW];if(aT-2<=aQ&&aQ<=aT+2){aN(j,aT,3,aS);var aY=q(j,aO,aS-3,aW-3,0);var aX=aY[0],aV=aY[1];aL.push({name:"h",from:[j[8],aX,aS],to:[aO[8],aV,aW]});aM=true;return !aM}});return !aM});$.each(aJ,function(aQ,aR){var aP=j[aR],aS=aR;$.each([1,2,0],function(aU,aV){var aT=aO[aV];if(aT-2<=aP&&aP<=aT+2){aN(j,aT,0,aS);var aY=q(j,aO,aS,aV,3);var aX=aY[0],aW=aY[1];aL.push({name:"v",from:[j[8],aS,aX],to:[aO[8],aV,aW]});aH=true;return !aH}});return !aH});return !(aM&&aH)});return aL};$.widget("ui.mydraggable",$.ui.draggable,{_create:function(){this.element.data($.ui.draggable.prototype.widgetName,this.element.data($.ui.mydraggable.prototype.widgetName));$.ui.draggable.prototype._create.call(this)},_generatePosition:function(aJ){aJ.target=$(aJ.target).closest(".jp-component")[0];var aQ=$.ui.draggable.prototype._generatePosition.call(this,aJ),aK=$(aJ.target);var aL=this;if($(aJ.target).data("dragging")){var aH=function(aS,aT,aR,aV){var aU=aR?"top":"left";aQ[aU]=aT+aS[aR]-aS[aV]-aL.offset.parent[aU]};var j=aK.data("connectors").slice(0),aN=aK.data("sibling-connectors"),aP=aJ.pageX-this.lastPageX,aO=aJ.pageY-this.lastPageY;for(var aI=0;aI<6;aI++){j[aI]+=((aI<3)?aP:aO)}var aM=V(j,aN,[1,2,0],[4,5,3],aH);$(aJ.target).data("rulers",aM)}return aQ},_mouseStart:function(aI){this.lastPageX=aI.pageX;this.lastPageY=aI.pageY;aI.target=$(aI.target).closest(".jp-component")[0];var aJ=$(aI.target).position(),j=[aJ.left,aJ.top];$s().not(aI.target).each(function(){var aK=$(this).position();(aK.left<j[0])&&(j[0]=aK.left);(aK.top<j[1])&&(j[1]=aK.top)});var aH=$(aI.target).parent().offset();j[0]=aH.left+aJ.left-j[0];j[1]=aH.top+aJ.top-j[1];j[2]=j[3]=1000000;this.options.containment=j;ad(aI.target);$.ui.draggable.prototype._mouseStart.call(this,aI)}});var ap=1000;var au=null;$(".jp-common-command a,.jp-common-command input").click(function(aH){var j=b[$(this).attr("id")];j&&j.call(b,aH)});var Q=null;$(".jp-commands >a").button().click(function(){if($(this).is("#jp-reset-all")){P().clearLastSettings(editorSettings.settingsID);C(editorSettings.getURL())}else{if($(this).is("#jp-reset-position")){P().setDragCSS(editorSettings.settingsID,"");C(editorSettings.getURL())}else{if($(this).is(".jp-ok")){P().setDragCSS(editorSettings.settingsID,an.getDragCSS());window.close()}else{if($(this).is(".jp-upload-template")){var j=b.sourceCodeViewer.util.encodeTemplate();var aH=(editorSettings.settingsID||"__")=="__"?"":editorSettings.settingsID;if(!Q){Q=new ae()}Q.open(aH,function(aI){if((aI||"").match(/^\s*$/)){return false}else{editorSettings.settingsID=aI;j.settingsID=editorSettings.settingsID;j.how="upload";$.post(editorSettings.templateService,j,function(aJ){});return true}})}else{if(editorSettings.callback){editorSettings.callback()}window.close()}}}}});$(".jp-new-barcode").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-layers").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border-style").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$(".jp-border-width").button({icons:{primary:"jp-primary-icon",secondary:"ui-icon-triangle-1-s"},text:false});$("#jp-barcode-chooser a").click(function(j){b["jp-new-barcode"].call(b,j)});var m=[".jp-view001,.jp-view011,.jp-view010",".jp-view100,.jp-view101,.jp-view001",".jp-view100,.jp-view110,.jp-view010"];B.forView(1<<editorSettings.type);$(".jp-main-tools .jp-button-set").each(function(){$(m[editorSettings.type],this).remove();$(this).css("display","block");if(!$(this).is(".jp-commands")){$(this).buttonset()}});function s(j){var aI=[100],aH=$(".jp-component",at);if(j){aH=aH.not(j)}aH.vals(["css","z-index"],aI);return Math.max.apply(null,aI)+1}var U=false;$(".jp-page").selectable({distance:1,filter:".jp-component",start:function(aH){f();var j=$(aH.target).data("selectable-item",null).data("selectable");j.helper.css("z-index",s());if(au){var aI=j.options.filter;j.options.filter="#jp-undefined";j.selectees=$("#jp-undefined",aH.target);$(aH.target).data("_filter",aI)}},stop:function(aJ){if(au){var aI=$(aJ.target).data("selectable").helper;var aK=aI.offset();var j=aI.width();if(j<10){j=150}var aH=aI.height();if(aH<10){aH=30}$s().unselect();c(au.appendTo(at).offset(aK).width(j).height(aH).select());ao.add(new v(au,["_appendTo"],null,at));G.edit(au);$(aJ.target).data("selectable").options.filter=$(aJ.target).data("_filter");d();U=true}aJ.stopPropagation();return false}}).find(".jp-paper-background").click(function(j){if($(j.target).is(".jp-paper-background")&&!U){$s().unselect()}U=false}).dblclick(function(j){if(!$(j.target).closest(".jp-component").length){b["jp-new"].call(b)}});var G={edit:function(j){for(e in this.editors){if(j.is(e)){this.editors[e].open(j)}}},editors:{".jp-text":aw,".jp-label":aw,".jp-barcode":F,".jp-image":new M()}};ah();var K=null;$(window).resize(function(){var j=$(this).innerHeight()-$(".jp-toolbar").height()-4;$(".jp-content").outerHeight(j)});$(window).resize();setTimeout(function(){af($("#jp-font-chooser").change(b["jp-font"]));if(editorSettings.type==1){C(editorSettings.getURL())}else{if(editorSettings.type==2){if(!editorSettings.settingsID){editorSettings.settingsID="__";K=new aA().open();b["jp-new"].call(b)}else{K=new aA().open();C(editorSettings.templateService+"&how=download&settingsID="+encodeURI(editorSettings.settingsID))}}}},1000);if(!editorSettings.willLoad()){at.removeClass("jp-hidden")}function c(aI,aH){var j=$(aI).each(function(){var aJ=this;if(!$(aJ).is(".jp-ininted")){$(aJ).addClass("jp-ininted").mydraggable({start:function(aM,aN){selected=$s().each(function(){var aO=$(this);aO.data("offset",aO.offset())});if(!$(this).selected()){$(this).select()}offset=$(this).offset();var aL=[],aK=["offset"];selected.vals(aK,aL);$(aM.target).data({oldOffsets:aL,dragging:selected.length==1})},stop:function(aM){$(aM.target).data({dragging:false,rulers:null});$(".jp-ruler-element").css("display","none");var aL=[],aK=["offset"];$s().vals(aK,aL);ao.add(new v($s(),aK,$(aM.target).data("oldOffsets"),aL))},drag:function(aM,aO){var aL=aO.position.top-offset.top,aK=aO.position.left-offset.left;selected.not(this).each(function(){var aP=$(this),aQ=aP.data("offset");aP.css({top:aQ.top+aL,left:aQ.left+aK})});var aN=$(aM.target).data("rulers");if(aN){y(aM.target,aN)}}}).resizable({rulerSet:true,start:function(aL,aK){ad(aL.target);var aM={width:$(aL.target).width(),height:$(aL.target).height()};aM.dx=$(aL.target).outerWidth()-aM.width;aM.dy=$(aL.target).outerHeight()-aM.height;$(aL.target).data({oldVals:aM,dragging:true})},resize:function(aM,aL){var aK=$(aM.target).data("rulers");if(aK){y(aM.target,aK)}},stop:function(aM){var aO=$(aM.target);$(".jp-ruler-element").css("display","none");var aK=aO.width(),aL=aO.height();var aN=aO.data("oldVals");ao.open();ao.add(new v(aO,["width"],aN.width,aK));ao.add(new v(aO,["height"],aN.height,aL));ao.close();aO.data({dragging:false,rulers:null,oldVals:null})}}).mousedown(function(aK){if(!$(this).selected()){$(this).select();if(!aK.ctrlKey){$(this).siblings().unselect()}}}).dblclick(function(aK){G.edit($(this))})}});if(!aH){j.css("z-index",s(j))}return j}});